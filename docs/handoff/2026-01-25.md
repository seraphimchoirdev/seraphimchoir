# AI Context Handoff

**Project**: seraphimChoir (새로핌ON)
**Date**: 2026-01-25 23:55 KST
**From**: Claude Opus 4.5
**To**: Next AI Agent / Human Developer
**Related Ticket/Issue**: N/A

---

## 1. Current State Summary

> 새로핌ON 프로젝트가 `develop` 브랜치에서 안정적으로 동작 중입니다. 오늘 핸드오프 문서 뷰어 기능이 관리자 페이지에 추가되었습니다.

- 애플리케이션 상태: 로컬 dev 환경 정상 동작, 빌드 성공
- 배포 상태: Vercel 배포 가능 상태, main 브랜치와 동기화됨
- 주요 마일스톤 진행 상황:
  - 출석 관리 CRUD 완료
  - Toast/Snackbar/AlertDialog 알림 시스템 도입 완료
  - 대원 관리 → 임원 포털로 통합 완료
  - PWA 인앱 브라우저 감지 추가
  - 핸드오프 자동화 시스템 v2.0 완료 (12개 섹션 템플릿)
  - **관리자용 핸드오프 문서 뷰어 UI 추가** (NEW)

---

## 2. Important Context

> 다음 작업자가 반드시 알아야 하는 배경 지식·제약·설계 의도.

- **도메인 제약**:
  - 찬양대원은 파트(SOPRANO, ALTO, TENOR, BASS, SPECIAL)별로 관리
  - 파트장은 자신의 파트 대원만 출석 입력 가능
  - 테스트 계정(`@test.com`)은 대원 연결 없이도 권한 사용 가능

- **기술적 제약**:
  - Supabase 무료 플랜 사용 중
  - 인앱 브라우저(카카오톡/네이버)에서 PWA 기능 제한됨

- **아키텍처 결정**:
  - 권한 검증은 `linked_member_id` 기반 (사용자-대원 1:1 매핑)
  - 알림 시스템: Toast(정보) → Snackbar(재시도 액션) → AlertDialog(확인 필수)
  - Sonner 라이브러리로 Toast 구현
  - 핸드오프 문서는 파일시스템 기반 (`docs/handoff/*.md`)

---

## 3. Completed Work

> 이번 세션에서 **완전히 끝난** 작업들.

- [x] feat(admin): 핸드오프 문서 뷰어 추가 (`/admin/handoff`)
- [x] fix(admin): 핸드오프 문서 뷰어 Vercel 호환성 수정 (fs 접근 → API 라우트)
- [x] feat(admin): 핸드오프 문서 뷰어 UI 대폭 개선
  - 섹션별 아이콘/색상 매핑
  - 목차(ToC) 사이드바 + 스크롤 하이라이트
  - 키보드 네비게이션 (←/→)
  - 마크다운 파싱 및 리치 렌더링 (테이블, 코드 블록, 체크박스)
- [x] docs(handoff): 2025-12-29 ~ 2026-01-24 핸드오프 문서 일괄 생성
- [x] chore: Claude 훅 참조 문서 추가 및 로컬 설정 gitignore 처리
- [x] fix(members): 상태 변경 드롭다운 클릭 불가 및 휴직 처리 UX 개선
- [x] chore: Prettier 설정 및 알림 시스템 도입, ESLint 규칙 완화
- [x] feat(attendances): 출석 관리 페이지 UX 개선 (MemberChip 3열 레이아웃)
- [x] refactor(nav): 대원 관리 메뉴를 임원 포털로 통합
- [x] feat(pwa): 인앱 브라우저 감지 및 외부 브라우저 안내 추가
- [x] fix(attendances): 파트장 권한 검증 시 linked_member_id 사용
- [x] feat(auth): 테스트 계정 대원 연결 없이 권한 사용 가능하도록 처리

세부 내용:
- 코드: `src/app/admin/handoff/`, `src/app/api/admin/handoff/`
- 문서: `docs/handoff/*.md` (22개 파일)

---

## 4. Immediate Next Steps

> 다음 작업자가 "바로 이어서" 하면 좋은 액션을 우선순위대로 정리합니다.

1. **(High)** TypeScript 타입 에러 해결
   - 목표: 린트 에러 4개 해결 (react-hooks/set-state-in-effect 관련)
   - 참고 파일: `src/components/features/pwa/InAppBrowserAlert.tsx`, `src/hooks/useRestoreDraft.ts`

2. **(Medium)** metadataBase 설정
   - 목표: SEO 최적화를 위해 `app/layout.tsx`에 metadataBase 설정 추가
   - 참고 파일: `src/app/layout.tsx`

3. **(Low)** Sentry SDK 업데이트
   - 목표: `@sentry/nextjs` deprecation 경고 대응
   - 참고: 다음 마이너 업데이트 시 확인

---

## 5. Decisions Made

> 이번 세션에서 내린 중요한 의사결정과 그 이유를 기록합니다.

| 결정사항 | 이유 / 근거 | 고려했으나 선택하지 않은 대안 |
|---------|------------|----------------------------|
| 핸드오프 뷰어를 클라이언트 렌더링으로 구현 | Vercel 서버리스 환경에서 fs 접근 불가, API 라우트로 우회 | 서버 컴포넌트에서 직접 fs 읽기 |
| 섹션별 아이콘/색상 하드코딩 | 12개 섹션이 고정적, 동적 처리 불필요 | JSON 설정 파일로 분리 |
| 마크다운 파싱 직접 구현 | react-markdown 대비 번들 사이즈 절약, 커스텀 UI 적용 용이 | react-markdown + rehype 플러그인 |
| 키보드 네비게이션 추가 | 문서 간 빠른 이동으로 UX 향상, 접근성 고려 | 스와이프 제스처 (모바일) |
| Toast/Snackbar/AlertDialog 3단계 알림 체계 | 사용자 피드백 유형에 따른 명확한 구분 필요 | 단일 Toast로 통합 |

---

## 6. Blockers & Open Questions

> 막혀 있는 부분과 아직 결정되지 않은 질문들.

### Blockers (진행을 막는 이슈)
- 없음

### Open Questions (다음 세션에서 결정해야 할 것)
- metadataBase에 설정할 프로덕션 도메인 확정 필요
  - 옵션: `https://seraphim-on.vercel.app` / 커스텀 도메인
  - 개인 의견: 커스텀 도메인 구매 후 설정 권장
- 핸드오프 문서 검색 기능 확장 (전문 검색 vs 날짜만)
  - 현재는 날짜로만 검색 가능

---

## 7. Critical Files & Locations

> 다음 작업자가 꼭 열어봐야 하는 파일과 위치.

| 파일 | 역할 | 주의사항 |
|------|------|----------|
| `src/app/admin/handoff/page.tsx` | 핸드오프 목록 페이지 | 월별 그룹화, 캘린더형 그리드 |
| `src/app/admin/handoff/[date]/page.tsx` | 핸드오프 상세 뷰어 | 마크다운 파싱, 섹션별 UI |
| `src/app/api/admin/handoff/route.ts` | 핸드오프 목록 API | fs 읽기, Vercel 호환 |
| `src/app/api/admin/handoff/[date]/route.ts` | 핸드오프 상세 API | 마크다운 → HTML 변환 |
| `src/lib/toast.ts` | Toast 유틸리티 함수 | 재시도 콜백은 두 번째 인자로 전달 |
| `middleware.ts` | 인증 미들웨어 | 테스트 계정 예외 처리 로직 포함 |

문서:
- `docs/handoff/*.md` — AI 세션 핸드오프 문서 (22개)
- `docs/NOTIFICATION_SYSTEM_ANALYSIS.md` — 알림 시스템 설계
- `~/.claude/commands/handoff.md` — 핸드오프 스킬 정의
- `CLAUDE.md` — 프로젝트 가이드

---

## 8. Patterns & Conventions

> 이번에 정착시키거나 발견한 패턴/컨벤션.

- **알림 패턴**: Toast(정보) → Snackbar(재시도 액션) → AlertDialog(확인 필수)
  ```typescript
  showSuccess('저장되었습니다.');
  showError('저장 실패', handleRetry);  // 재시도 버튼 포함
  ```
- **핸드오프 문서 뷰어 UI 패턴**:
  - 섹션별 고유 아이콘/색상 (`sectionIcons`, `sectionColors` 객체)
  - 접을 수 있는 카드 UI (`SectionCard` 컴포넌트)
  - 스크롤 위치 기반 목차 하이라이트 (IntersectionObserver)
- **Import 정렬**: `@trivago/prettier-plugin-sort-imports` (react → next → @/ → 상대경로)
- **테스트 계정**: `@test.com` 도메인으로 통일

---

## 9. Potential Gotchas

> 다음 사람이 다시 삽질하지 않도록 주의사항을 남깁니다.

- Vercel 서버리스 환경에서는 `fs` 모듈을 직접 사용할 수 없음 → API 라우트로 우회
- Supabase RLS 변경 후에는 브라우저 캐시를 꼭 비워야 테스트가 정상 동작함
- 테스트 계정 이메일 도메인은 `@test.com`으로 통일 (이전: `@example.com`)
- 인앱 브라우저(카카오톡/네이버)에서는 PWA 기능이 제한됨 → 외부 브라우저 안내 표시
- React 19 새 규칙이 과도하게 엄격 → ESLint warning으로 완화됨 (`react-hooks/set-state-in-effect`)

---

## 10. Environment State

> 이 문서 작성 시점의 개발 환경 상태.

| 항목 | 값 |
|------|-----|
| **Git Branch** | `develop` |
| **Last Commit** | `35d890a` - chore: 세션 종료 전 자동 저장 |
| **Node Version** | v24.13.0 |
| **Package Manager** | npm 11.6.2 |

필수 서비스:
- Supabase (원격 인스턴스 사용 중)
- Docker (로컬 Supabase 사용 시 필요)

필요한 환경 변수:
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`

---

## 11. Testing & Quality

> 지금까지의 품질 상태를 빠르게 파악할 수 있게 합니다.

- Unit Tests: 미구현
- Integration / E2E: 미구현
- 타입 체크: pass (빌드 성공)
- 린트: 4 errors, 34 warnings (대부분 `@typescript-eslint/no-explicit-any`, `react-hooks/set-state-in-effect`)
- 빌드: 성공 (55개 페이지 생성)

---

## 12. Documentation Updates

> 어떤 문서를 이미 업데이트했고, 무엇을 나중에 업데이트해야 하는지.

- 업데이트 완료: `docs/handoff/*.md` (22개 파일 생성)
- 업데이트 완료: `~/.claude/commands/handoff.md` (12개 섹션 템플릿)
- 추후 필요: `CLAUDE.md` - 핸드오프 뷰어 접근 방법 추가

---

## Session Statistics

| 항목 | 값 |
|------|-----|
| **세션 시간** | 오늘 전체 |
| **커밋 수** | 31개 (오늘 전체) |

---

## Related Commits

| 해시 | 메시지 | 시간 |
|------|--------|------|
| `35d890a` | chore: 세션 종료 전 자동 저장 | 2 minutes ago |
| `f81dead` | feat(admin): 핸드오프 문서 뷰어 UI 대폭 개선 | 4 minutes ago |
| `993bded` | fix(admin): 핸드오프 문서 뷰어 Vercel 호환성 수정 | 8 minutes ago |
| `a02933e` | feat(admin): 핸드오프 문서 뷰어 추가 | 16 minutes ago |
| `daccee5` | docs(handoff): 2025-12-29 ~ 2026-01-24 핸드오프 문서 일괄 생성 | 33 minutes ago |
| `118fa5a` | chore: Claude 훅 참조 문서 추가 및 로컬 설정 gitignore 처리 | 50 minutes ago |
| `74bb916` | fix(members): 상태 변경 드롭다운 클릭 불가 및 휴직 처리 UX 개선 | 6 hours ago |
| `7b379d7` | chore: Prettier 설정 및 알림 시스템 도입, ESLint 규칙 완화 | 7 hours ago |
| `0c03bf0` | feat(attendances): 출석 관리 페이지 UX 개선 | 8 hours ago |
| `ff172b0` | refactor(nav): 대원 관리 메뉴를 임원 포털로 통합 | 8 hours ago |
| `dbea346` | feat(pwa): 인앱 브라우저 감지 및 외부 브라우저 안내 추가 | 9 hours ago |
| `d2061fd` | fix(attendances): 파트장 권한 조회 시 linked_member_id 사용 | 9 hours ago |
| `0788f69` | refactor(management): 대원 관리를 임원 포털로 통합 및 권한 개선 | 9 hours ago |
| `231de32` | fix(attendances): 파트장 권한 검증 시 linked_member_id 사용하도록 수정 | 10 hours ago |
| `94c6bda` | feat(auth): 테스트 계정 대원 연결 없이 권한 사용 가능하도록 처리 | 13 hours ago |

---

_이 문서는 `/handoff` 스킬로 자동 생성되었습니다._
