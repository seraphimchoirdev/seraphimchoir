# PRD (Product Requirements Document)

# 찬양대 자리배치 시스템

**버전**: 1.0
**최종 수정일**: 2024년 11월 18일
**작성자**: Choir Seat Arranger Team

---

## 1. 프로젝트 개요

### 1.1 배경

교회 찬양대의 자리배치는 매주 반복되는 중요한 작업입니다. 현재 대부분의 찬양대는 수동으로 자리를 배치하며, 이 과정에서 다음과 같은 문제가 발생합니다:

- 찬양대원의 등단 현황을 수집하는 데 시간이 소요됨
- 파트별 균형, 키, 경력 등을 고려한 최적 배치를 찾기 어려움
- 과거 배치 데이터를 활용하지 못함
- 배치표를 작성하고 공유하는 과정이 번거로움

### 1.2 솔루션

AI 기반 자동 추천 시스템을 통해 찬양대 자리배치를 효율적으로 관리하는 웹 애플리케이션을 개발합니다. 과거 배치 데이터를 학습하여 최적의 자리배치를 추천하고, 드래그 앤 드롭으로 간편하게 조정할 수 있습니다.

### 1.3 목표

1. **효율성**: 자리배치 작업 시간을 기존 대비 70% 이상 단축
2. **품질**: AI 추천을 통한 최적의 자리배치 제공
3. **접근성**: 모바일에서도 쉽게 사용할 수 있는 반응형 웹 제공
4. **자동화**: 카카오톡 연동으로 등단 현황 수집 및 배치표 공유 자동화

---

## 2. 대상 사용자

### 2.1 주요 사용자 (Primary Users)

- **찬양대 지휘자**: 자리배치 결정 및 최종 승인
- **찬양대 총무**: 등단 현황 관리 및 배치표 작성

### 2.2 부차적 사용자 (Secondary Users)

- **찬양대원**: 자신의 등단 현황 확인 및 입력
- **교회 관리자**: 시스템 설정 및 사용자 관리

---

## 3. 기능 요구사항

### 3.1 Phase 2: 인원 관리 기능

#### FR-2.1 찬양대원 등록 및 관리

- **우선순위**: P0 (필수)
- **설명**: 찬양대원의 기본 정보를 등록하고 관리합니다.
- **상세 요구사항**:
  - 찬양대원 정보 입력 (이름, 파트, 키, 경력, 연락처, 이메일)
  - 파트는 Soprano, Alto, Tenor, Bass, Special 중 선택
  - 리더, 솔리스트 여부 표시
  - 특이사항 메모 기능
  - 찬양대원 목록 조회 (파트별 필터링, 이름 검색)
  - 찬양대원 정보 수정/삭제

#### FR-2.2 등단 현황 관리

- **우선순위**: P0 (필수)
- **설명**: 주간 예배별 찬양대원 등단 가능 여부를 관리합니다.
- **상세 요구사항**:
  - 날짜별 등단 현황 입력/수정
  - 등단 가능/불가능 표시
  - 비고 사항 입력 (결석 사유 등)
  - 파트별 등단 인원 통계 표시
  - 캘린더 뷰로 월별 등단 현황 확인

#### FR-2.3 통계 및 리포트

- **우선순위**: P1 (높음)
- **설명**: 찬양대원별/파트별 통계를 제공합니다.
- **상세 요구사항**:
  - 찬양대원별 출석률 통계
  - 파트별 평균 등단 인원
  - 월별/분기별 통계 리포트

### 3.2 Phase 3: 자리배치 UI 구현

#### FR-3.1 좌석 그리드 시스템

- **우선순위**: P0 (필수)
- **설명**: 찬양대 좌석을 시각적으로 표시하고 관리합니다.
- **상세 요구사항**:
  - 행(Row)과 열(Column) 기반 그리드 표시
  - 파트별 영역 구분 (색상 코딩)
  - 빈 좌석과 배치된 좌석 시각적 구분
  - 찬양대원 이름 표시
  - 좌석 수 동적 조정 (행/열 추가/삭제)

#### FR-3.2 드래그 앤 드롭 배치

- **우선순위**: P0 (필수)
- **설명**: 직관적인 드래그 앤 드롭으로 자리를 조정합니다.
- **상세 요구사항**:
  - 찬양대원을 좌석으로 드래그하여 배치
  - 좌석 간 찬양대원 위치 교환
  - 실시간 배치 변경 반영
  - Undo/Redo 기능

#### FR-3.3 배치 템플릿

- **우선순위**: P1 (높음)
- **설명**: 자주 사용하는 배치를 템플릿으로 저장합니다.
- **상세 요구사항**:
  - 현재 배치를 템플릿으로 저장
  - 저장된 템플릿 불러오기
  - 템플릿 이름 및 설명 관리

### 3.3 Phase 4: AI 자동 배치 알고리즘

#### FR-4.1 AI 배치 추천

- **우선순위**: P0 (필수)
- **설명**: 과거 데이터와 규칙을 학습하여 최적의 배치를 추천합니다.
- **상세 요구사항**:
  - 과거 배치 데이터 학습
  - 파트별 균형 고려
  - 키 순서 고려 (일반적으로 앞쪽: 작은 키, 뒤쪽: 큰 키)
  - 경력 분산 (초보자와 경력자 골고루 배치)
  - 리더 위치 최적화
  - 추천 배치 복수 생성 (1순위, 2순위, 3순위)

#### FR-4.2 ML 서비스 연동

- **우선순위**: P1 (높음)
- **설명**: Python FastAPI 기반 ML 서비스와 연동합니다.
- **상세 요구사항**:
  - REST API로 배치 요청
  - 추천 결과 수신 및 표시
  - ML 모델 재학습 트리거

#### FR-4.3 배치 규칙 설정

- **우선순위**: P1 (높음)
- **설명**: 교회별 특성에 맞는 배치 규칙을 설정합니다.
- **상세 요구사항**:
  - 키 순서 규칙 (오름차순/내림차순/무시)
  - 파트별 선호 위치 설정
  - 특정 찬양대원 고정 위치 설정
  - 인접 배치 금지 규칙

### 3.4 Phase 5: 배치표 이미지 생성

#### FR-5.1 배치표 미리보기

- **우선순위**: P0 (필수)
- **설명**: 최종 배치표를 워드 스타일 표 형식으로 미리보기합니다.
- **상세 요구사항**:
  - 날짜, 제목, 예배 정보 표시
  - 파트별 구분된 표 형식
  - 지휘자 정보 표시
  - 인쇄 친화적 레이아웃

#### FR-5.2 이미지 생성 및 다운로드

- **우선순위**: P0 (필수)
- **설명**: 배치표를 이미지로 변환하여 저장/공유합니다.
- **상세 요구사항**:
  - PNG/JPG 형식으로 이미지 생성
  - 고해상도 옵션 (인쇄용)
  - 다운로드 기능
  - 클립보드 복사 기능

#### FR-5.3 스타일 커스터마이징

- **우선순위**: P2 (중간)
- **설명**: 배치표의 스타일을 교회별로 커스터마이징합니다.
- **상세 요구사항**:
  - 교회 로고 삽입
  - 색상 테마 선택
  - 폰트 설정
  - 레이아웃 템플릿

### 3.5 Phase 6: 카카오톡 연동

#### FR-6.1 등단 현황 수집

- **우선순위**: P1 (높음)
- **설명**: 카카오톡으로 찬양대원의 등단 현황을 수집합니다.
- **상세 요구사항**:
  - 카카오톡 봇으로 등단 여부 질문 발송
  - 찬양대원의 응답 자동 수집
  - 응답 데이터 시스템 자동 반영
  - 미응답자 리마인더 발송

#### FR-6.2 배치표 공유

- **우선순위**: P1 (높음)
- **설명**: 완성된 배치표를 카카오톡으로 공유합니다.
- **상세 요구사항**:
  - 찬양대 단체 채팅방으로 배치표 이미지 전송
  - 개인별 자리 위치 안내 메시지 발송
  - 발송 예약 기능

#### FR-6.3 카카오톡 알림

- **우선순위**: P2 (중간)
- **설명**: 중요 이벤트에 대한 알림을 발송합니다.
- **상세 요구사항**:
  - 새 배치표 생성 알림
  - 등단 현황 입력 마감 알림
  - 자리 변경 알림

### 3.6 Phase 7: 배포 및 최적화

#### FR-7.1 사용자 인증

- **우선순위**: P0 (필수)
- **설명**: Supabase Auth를 활용한 안전한 사용자 인증 시스템을 구축합니다.
- **상세 요구사항**:
  - 이메일/비밀번호 로그인 (Supabase Auth, 기본)
  - Kakao OAuth 로그인 (Phase 6에서 추가)
  - 역할 기반 권한 관리 (ADMIN/CONDUCTOR/MANAGER/PART_LEADER) - RLS 정책 활용
  - **역할/권한 부여는 ADMIN만 가능**
  - 세션 관리 (쿠키 기반)
  - 비밀번호 재설정 (Supabase Auth Magic Link)
  - 이메일 인증

#### FR-7.2 성능 최적화

- **우선순위**: P1 (높음)
- **설명**: 빠른 로딩과 부드러운 사용자 경험을 제공합니다.
- **상세 요구사항**:
  - 이미지 최적화
  - 코드 스플리팅
  - 서버 사이드 렌더링 (SSR) 활용
  - 캐싱 전략

#### FR-7.3 모바일 최적화

- **우선순위**: P0 (필수)
- **설명**: 모바일 환경에서도 완벽하게 동작합니다.
- **상세 요구사항**:
  - 반응형 디자인
  - 터치 친화적 UI
  - 모바일 드래그 앤 드롭 최적화
  - PWA 지원 (선택)

---

## 4. 비기능 요구사항

### 4.1 성능

- **페이지 로딩 시간**: 초기 로딩 3초 이내
- **AI 추천 응답 시간**: 5초 이내
- **이미지 생성 시간**: 3초 이내
- **동시 접속자**: 최소 100명 지원

### 4.2 보안

- **데이터 암호화**: Supabase Auth의 내장 암호화 사용
- **Row Level Security (RLS)**: Supabase RLS로 데이터 접근 제어
- **SQL Injection 방지**: Supabase Client의 매개변수화된 쿼리 사용
- **XSS 방지**: React의 기본 escaping 활용
- **CSRF 방지**: Supabase Auth의 쿠키 기반 인증
- **환경 변수**: 민감 정보는 .env 파일로 관리 (Service Role Key는 서버 전용)

### 4.3 사용성

- **학습 시간**: 30분 이내에 기본 기능 사용 가능
- **접근성**: WCAG 2.1 AA 수준 준수
- **브라우저 지원**: Chrome, Safari, Firefox, Edge 최신 2개 버전
- **언어**: 한국어 UI

### 4.4 유지보수성

- **코드 커버리지**: 핵심 로직 80% 이상
- **타입 안정성**: TypeScript strict mode 사용
- **코드 스타일**: ESLint 규칙 준수
- **문서화**: 주요 함수 및 컴포넌트 JSDoc 주석

### 4.5 확장성

- **데이터베이스**: PostgreSQL로 대용량 데이터 지원
- **마이크로서비스**: ML 서비스 분리로 독립적 확장
- **캐싱**: React Query로 클라이언트 사이드 캐싱

---

## 5. 기술 스택

### 5.1 프론트엔드

- **프레임워크**: Next.js 16 (App Router)
- **UI 라이브러리**: React 19
- **언어**: TypeScript
- **스타일링**: Tailwind CSS 4
- **상태 관리**:
  - 클라이언트: Zustand
  - 서버: React Query (@tanstack/react-query)
- **드래그 앤 드롭**: React DnD
- **아이콘**: Lucide React
- **날짜 처리**: date-fns

### 5.2 백엔드

- **Backend-as-a-Service**: Supabase
- **데이터베이스**: PostgreSQL (Supabase 관리)
- **인증**: Supabase Auth
- **스토리지**: Supabase Storage
- **실시간 기능**: Supabase Realtime (선택적)
- **API**: Next.js API Routes (보조적)

### 5.3 ML 서비스

- **프레임워크**: Python FastAPI
- **ML 라이브러리**: scikit-learn, TensorFlow (선택)
- **배포**: Docker 컨테이너

### 5.4 인프라

- **호스팅**: Vercel (Next.js) / AWS (ML 서비스)
- **백엔드 & 데이터베이스**: Supabase
- **이미지 저장**: Supabase Storage
- **CDN**: Supabase CDN (자동)

---

## 6. 제약사항

### 6.1 기술적 제약

- Node.js 18.0 이상 필요
- Supabase 프로젝트 필요 (무료 티어 가능)
- 브라우저에서 JavaScript 활성화 필수
- 로컬 개발 시 Docker 필요 (Supabase CLI 사용 시)

### 6.2 비즈니스 제약

- 초기 버전은 단일 교회만 지원
- 카카오톡 API 사용료 고려 필요
- ML 모델 학습을 위한 최소 과거 데이터 필요 (최소 10회 이상의 배치 기록)

### 6.3 일정 제약

- Phase 2-3: MVP 출시 목표 (2개월)
- Phase 4-5: AI 기능 추가 (1개월)
- Phase 6-7: 완성 및 배포 (1개월)

---

## 7. 우선순위 매트릭스

| 기능                 | 우선순위 | Phase | 비즈니스 가치 | 기술 난이도 |
| -------------------- | -------- | ----- | ------------- | ----------- |
| 인원 관리            | P0       | 2     | 높음          | 낮음        |
| 등단 현황 관리       | P0       | 2     | 높음          | 낮음        |
| 좌석 그리드 UI       | P0       | 3     | 높음          | 중간        |
| 드래그 앤 드롭       | P0       | 3     | 높음          | 중간        |
| AI 배치 추천         | P0       | 4     | 매우 높음     | 높음        |
| 배치표 이미지 생성   | P0       | 5     | 높음          | 중간        |
| 사용자 인증          | P0       | 7     | 높음          | 낮음        |
| 모바일 최적화        | P0       | 7     | 높음          | 중간        |
| 카카오톡 등단 수집   | P1       | 6     | 중간          | 높음        |
| 카카오톡 배치표 공유 | P1       | 6     | 중간          | 중간        |
| 배치 템플릿          | P1       | 3     | 중간          | 낮음        |
| 통계 리포트          | P1       | 2     | 중간          | 낮음        |
| ML 모델 재학습       | P2       | 4     | 낮음          | 높음        |
| 스타일 커스터마이징  | P2       | 5     | 낮음          | 중간        |

---

## 8. UI/UX 요구사항

### 8.1 디자인 원칙

1. **단순성**: 직관적이고 간결한 인터페이스
2. **일관성**: 통일된 디자인 언어와 패턴
3. **피드백**: 모든 액션에 즉각적인 시각적 피드백
4. **오류 방지**: 실수를 방지하는 가드레일 제공

### 8.2 주요 화면

1. **대시보드**: 이번 주 등단 현황 및 최근 배치 요약
2. **찬양대원 관리**: 목록, 등록, 수정, 삭제
3. **등단 현황**: 캘린더 뷰 및 파트별 통계
4. **자리배치**: 그리드 UI 및 드래그 앤 드롭
5. **배치표**: 미리보기 및 이미지 생성
6. **설정**: 배치 규칙, 사용자 관리, 시스템 설정

### 8.3 접근성

- 키보드 네비게이션 지원
- 스크린 리더 호환
- 충분한 색상 대비
- 명확한 레이블과 힌트

---

## 9. 데이터 모델

### 9.1 핵심 엔티티

#### Member (찬양대원)

```typescript
{
  id: string;
  name: string;
  part: 'SOPRANO' | 'ALTO' | 'TENOR' | 'BASS' | 'SPECIAL';
  height: number | null;
  experience: number; // 활동 년수
  isLeader: boolean;
  phoneNumber: string | null;
  email: string | null;
  notes: string | null;
}
```

#### Attendance (등단 현황)

```typescript
{
  id: string;
  memberId: string;
  date: Date;
  isAvailable: boolean;
  notes: string | null;
}
```

#### Arrangement (자리배치)

```typescript
{
  id: string;
  date: Date;
  title: string;
  serviceInfo: string | null;
  conductor: string | null;
  imageUrl: string | null;
  isPublished: boolean;
}
```

#### Seat (좌석)

```typescript
{
  id: string;
  arrangementId: string;
  memberId: string;
  row: number;
  column: number;
  part: Part;
}
```

---

## 10. 위험 요소 및 대응 방안

### 10.1 기술적 위험

| 위험                     | 영향도 | 발생 가능성 | 대응 방안                     |
| ------------------------ | ------ | ----------- | ----------------------------- |
| AI 모델 정확도 낮음      | 높음   | 중간        | 규칙 기반 폴백, 점진적 학습   |
| 드래그 앤 드롭 성능 이슈 | 중간   | 낮음        | 가상화, 최적화                |
| 카카오톡 API 변경        | 중간   | 중간        | API 버전 고정, 대체 채널 준비 |
| 데이터베이스 성능 저하   | 높음   | 낮음        | 인덱싱, 쿼리 최적화, 캐싱     |

### 10.2 비즈니스 위험

| 위험                 | 영향도 | 발생 가능성 | 대응 방안               |
| -------------------- | ------ | ----------- | ----------------------- |
| 사용자 학습 곡선     | 중간   | 중간        | 튜토리얼, 가이드 제공   |
| 교회별 요구사항 차이 | 높음   | 높음        | 설정 가능한 규칙 시스템 |
| 데이터 마이그레이션  | 중간   | 높음        | Excel 임포트 기능       |

---

## 11. 성공 지표 (KPI)

### 11.1 사용성 지표

- **작업 시간 단축률**: 70% 이상
- **사용자 만족도**: 4.0/5.0 이상
- **오류율**: 전체 배치 작업의 5% 이하

### 11.2 기술 지표

- **페이지 로딩 시간**: 평균 2초 이하
- **AI 추천 정확도**: 80% 이상 (사용자 수정 없이 승인)
- **시스템 가동률**: 99% 이상

### 11.3 비즈니스 지표

- **활성 사용자 수**: 첫 3개월 내 10개 교회
- **주간 활성도**: 매주 1회 이상 사용
- **데이터 축적**: 교회당 평균 20회 이상 배치 기록

---

## 12. 향후 로드맵 (Phase 8+)

### 12.1 고급 기능

- 다중 교회 지원 (멀티 테넌트) - Supabase RLS 정책 활용
- 예배별 자리배치 (주일 오전/오후, 수요예배 등)
- 음성 파트 테스트 결과 연동
- 연습 출석 관리
- 악보 관리 시스템 통합
- **실시간 등단 현황 업데이트** - Supabase Realtime 활용
- **실시간 협업 배치** - 여러 관리자가 동시에 배치 작업

### 12.2 통합

- Google Calendar 연동
- Slack 연동
- 교회 관리 시스템 (ChMS) 연동
- 악보 라이브러리 시스템 연동

### 12.3 분석

- 찬양대원별 성장 추적
- 파트별 밸런스 분석
- 최적 배치 패턴 분석 리포트

---

## 13. 참고 자료

- Prisma 문서: https://www.prisma.io/docs
- Next.js 문서: https://nextjs.org/docs
- React DnD 문서: https://react-dnd.github.io/react-dnd/
- 디자인 시스템: @UXUI_DESIGN_SYSTEM.md
- API 명세서: (TBD)

---

## 변경 이력

| 버전 | 날짜       | 변경 내용 | 작성자 |
| ---- | ---------- | --------- | ------ |
| 1.0  | 2024-11-18 | 최초 작성 | Team   |
