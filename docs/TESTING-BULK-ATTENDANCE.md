# 일괄 출석 입력 기능 테스트 가이드

## 테스트 환경 준비

### 1. 개발 서버 시작
```bash
npm run dev
```

### 2. 테스트 사용자 로그인
- PART_LEADER, MANAGER, CONDUCTOR 또는 ADMIN 역할이 필요합니다
- `/login`으로 이동하여 로그인

### 3. 테스트 데이터 준비
- 최소 5명 이상의 찬양대원이 등록되어 있어야 합니다
- 다양한 파트(SOPRANO, ALTO, TENOR, BASS)의 회원이 있으면 좋습니다

## 기능별 테스트

### A. 날짜별 일괄 입력 폼 테스트

#### Test Case 1: 기본 출석 입력
**목적:** 특정 날짜의 출석을 일괄로 입력

**단계:**
1. `/attendances/bulk` 페이지 접속
2. "날짜별 일괄 입력" 탭이 기본 선택되어 있는지 확인
3. 출석 날짜를 오늘 날짜로 선택
4. 모든 찬양대원이 파트별로 그룹화되어 표시되는지 확인
5. 일부 회원의 체크박스를 선택 (참석으로 표시)
6. 일부 회원의 체크박스를 해제 (불참으로 표시)
7. "선택된 인원" 카운터가 정확하게 업데이트되는지 확인
8. "제출" 버튼 클릭
9. 성공 메시지가 표시되는지 확인

**예상 결과:**
- ✓ 모든 회원이 파트별로 그룹화되어 표시됨
- ✓ 선택된 인원 카운터가 실시간 업데이트됨
- ✓ 제출 후 성공 메시지 표시
- ✓ "전체: N건 / 성공: N건 / 실패: 0건" 표시

#### Test Case 2: 불참 사유 입력
**목적:** 불참 회원의 사유를 기록

**단계:**
1. 회원의 체크박스를 해제 (불참으로 설정)
2. 불참 사유 입력 필드가 나타나는지 확인
3. "개인 사정"이라고 입력
4. 다른 회원도 불참으로 설정하고 "출장" 입력
5. "제출" 버튼 클릭
6. 성공 메시지 확인

**예상 결과:**
- ✓ 불참 회원 체크 해제 시 사유 입력 필드 표시
- ✓ 사유가 정상적으로 저장됨

#### Test Case 3: 전체 선택/해제
**목적:** 전체 선택/해제 버튼 동작 확인

**단계:**
1. "전체 선택" 버튼 클릭
2. 모든 회원이 선택되는지 확인
3. 선택된 인원이 전체 인원과 같은지 확인
4. "전체 해제" 버튼 클릭
5. 모든 회원이 해제되는지 확인
6. 선택된 인원이 0명인지 확인

**예상 결과:**
- ✓ "전체 선택" 시 모든 회원 선택됨
- ✓ "전체 해제" 시 모든 회원 해제됨

#### Test Case 4: 파트별 선택
**목적:** 파트별 "모두 선택" 버튼 동작 확인

**단계:**
1. "전체 해제" 버튼으로 초기화
2. SOPRANO 파트의 "모두 선택" 버튼 클릭
3. SOPRANO 파트만 선택되는지 확인
4. TENOR 파트의 "모두 선택" 버튼 클릭
5. SOPRANO와 TENOR 파트가 모두 선택되는지 확인

**예상 결과:**
- ✓ 파트별로 독립적으로 선택됨
- ✓ 다른 파트에 영향을 주지 않음

#### Test Case 5: 대량 데이터 처리
**목적:** 100명 이상의 출석 데이터를 처리할 수 있는지 확인

**조건:**
- 100명 이상의 찬양대원이 등록되어 있어야 함

**단계:**
1. "전체 선택" 버튼 클릭
2. "제출" 버튼 클릭
3. "처리 중..." 메시지가 표시되는지 확인
4. 데이터가 청크(100개씩)로 나뉘어 처리되는지 확인
5. 모든 데이터가 성공적으로 저장되는지 확인

**예상 결과:**
- ✓ 처리 중 로딩 인디케이터 표시
- ✓ 100개씩 나누어 처리됨
- ✓ 모든 데이터가 성공적으로 저장됨

### B. CSV 파일 업로드 테스트

#### Test Case 6: CSV 템플릿 다운로드
**목적:** CSV 템플릿을 정상적으로 다운로드할 수 있는지 확인

**단계:**
1. "CSV 파일 업로드" 탭 클릭
2. "CSV 템플릿 다운로드" 버튼 클릭
3. `attendance_template_YYYY-MM-DD.csv` 파일이 다운로드되는지 확인
4. 파일을 열어 다음 컬럼이 있는지 확인:
   - member_id, member_name, part, date, is_available, notes
5. 모든 현재 등록된 찬양대원이 포함되어 있는지 확인
6. 기본값이 올바르게 설정되어 있는지 확인 (is_available: true)

**예상 결과:**
- ✓ CSV 파일이 다운로드됨
- ✓ 모든 필수 컬럼이 포함됨
- ✓ 모든 찬양대원이 포함됨
- ✓ 한글이 깨지지 않음 (BOM 포함)

#### Test Case 7: 유효한 CSV 업로드
**목적:** 정상적인 CSV 파일을 업로드하고 처리

**단계:**
1. 다운로드한 템플릿 파일을 Excel 또는 텍스트 에디터로 열기
2. 일부 회원의 is_available을 "false"로 변경
3. 불참 회원의 notes에 "개인 사정" 입력
4. 파일을 저장
5. 드래그 앤 드롭 영역에 파일을 드롭하거나 "파일 선택" 버튼 클릭
6. 데이터 미리보기 테이블이 표시되는지 확인
7. 검증 결과에 "✓ 유효: N건, 오류: 0건" 메시지 확인
8. "업로드" 버튼 클릭
9. 성공 메시지 확인

**예상 결과:**
- ✓ 파일이 정상적으로 파싱됨
- ✓ 데이터 미리보기 정확하게 표시
- ✓ 검증 통과
- ✓ 업로드 성공

#### Test Case 8: 잘못된 날짜 형식
**목적:** 날짜 형식 검증

**단계:**
1. CSV 파일에서 날짜를 "2024/01/15" (슬래시 사용)로 변경
2. 파일 업로드
3. 데이터 미리보기에서 해당 행에 ✗ 표시 확인
4. 오류 메시지: "날짜 형식은 YYYY-MM-DD여야 합니다" 확인
5. "업로드" 버튼이 비활성화되는지 확인

**예상 결과:**
- ✓ 잘못된 날짜 형식 감지
- ✓ 오류 메시지 표시
- ✓ 업로드 버튼 비활성화

#### Test Case 9: 존재하지 않는 회원
**목적:** 회원 존재 여부 검증

**단계:**
1. CSV 파일에서 member_name을 "존재하지않는회원"으로 변경
2. member_id를 임의의 UUID로 변경
3. 파일 업로드
4. 데이터 미리보기에서 해당 행에 ✗ 표시 확인
5. 오류 메시지: "회원을 찾을 수 없습니다" 확인

**예상 결과:**
- ✓ 존재하지 않는 회원 감지
- ✓ 오류 메시지 표시

#### Test Case 10: 중복 데이터
**목적:** 중복 출석 기록 검증

**단계:**
1. CSV 파일에 같은 member_id와 date를 가진 행을 2개 추가
2. 파일 업로드
3. 데이터 미리보기에서 중복 행에 오류 표시 확인
4. 오류 메시지: "중복된 출석 기록" 확인

**예상 결과:**
- ✓ 중복 기록 감지
- ✓ 오류 메시지 표시

#### Test Case 11: 부분 성공
**목적:** 일부 데이터만 유효한 경우 처리

**단계:**
1. CSV 파일에 5개 행 준비:
   - 3개는 정상 데이터
   - 2개는 잘못된 날짜 형식
2. 파일 업로드
3. 미리보기에서 3개는 ✓, 2개는 ✗ 확인
4. 검증 결과: "유효: 3건, 오류: 2건" 확인
5. "업로드" 버튼이 비활성화되는지 확인 (오류가 있으므로)
6. 오류를 수정하고 다시 업로드
7. 성공 확인

**예상 결과:**
- ✓ 유효한 데이터와 무효한 데이터 구분
- ✓ 오류가 있으면 업로드 불가
- ✓ 오류 수정 후 업로드 가능

#### Test Case 12: 대용량 파일
**목적:** 파일 크기 제한 확인

**조건:**
- 5MB 이상의 CSV 파일 준비

**단계:**
1. 5MB 이상의 CSV 파일 업로드 시도
2. 오류 메시지: "파일 크기는 5MB를 초과할 수 없습니다" 확인

**예상 결과:**
- ✓ 파일 크기 제한 적용
- ✓ 명확한 오류 메시지

#### Test Case 13: is_available 다양한 값
**목적:** 출석 여부 값의 다양한 표현 지원

**단계:**
1. CSV 파일에 다양한 is_available 값 테스트:
   - "true", "false"
   - "1", "0"
   - "참석", "불참"
   - "o", "x"
   - "yes", "no"
2. 파일 업로드
3. 모든 값이 정상적으로 파싱되는지 확인
4. 미리보기에서 "참석" / "불참" 배지가 올바르게 표시되는지 확인

**예상 결과:**
- ✓ 모든 허용된 값이 정상적으로 파싱됨
- ✓ boolean 값으로 올바르게 변환됨

### C. 권한 테스트

#### Test Case 14: 권한 없는 사용자
**목적:** PART_LEADER 미만 역할의 접근 차단

**단계:**
1. MEMBER 역할의 사용자로 로그인
2. `/attendances/bulk` URL 직접 접속 시도
3. `/attendances?error=permission_denied`로 리다이렉트되는지 확인

**예상 결과:**
- ✓ 접근 거부
- ✓ 적절한 오류 메시지와 함께 리다이렉트

#### Test Case 15: 비로그인 사용자
**목적:** 인증되지 않은 사용자 접근 차단

**단계:**
1. 로그아웃
2. `/attendances/bulk` URL 직접 접속 시도
3. `/login?redirect=/attendances/bulk`로 리다이렉트되는지 확인

**예상 결과:**
- ✓ 로그인 페이지로 리다이렉트
- ✓ redirect 파라미터 포함

### D. UI/UX 테스트

#### Test Case 16: 반응형 디자인
**목적:** 다양한 화면 크기에서 정상 동작

**단계:**
1. 브라우저 창 크기를 모바일(375px), 태블릿(768px), 데스크톱(1920px)으로 변경
2. 각 크기에서 레이아웃이 깨지지 않는지 확인
3. 버튼과 입력 필드가 터치하기 쉬운 크기인지 확인

**예상 결과:**
- ✓ 모든 화면 크기에서 정상 표시
- ✓ 모바일에서도 사용 가능

#### Test Case 17: 로딩 상태
**목적:** 로딩 인디케이터 표시

**단계:**
1. 네트워크를 느린 3G로 설정 (Chrome DevTools)
2. 대량 데이터 제출
3. 로딩 스피너가 표시되는지 확인
4. "처리 중..." 텍스트가 표시되는지 확인
5. 버튼이 비활성화되는지 확인

**예상 결과:**
- ✓ 로딩 중 시각적 피드백 제공
- ✓ 중복 제출 방지

## 성능 테스트

### Test Case 18: 100명 출석 입력
**목적:** 대량 데이터 처리 성능 확인

**단계:**
1. 100명의 찬양대원 출석을 일괄 입력
2. 처리 시간 측정 (5초 이내 권장)
3. 메모리 사용량 확인 (Chrome DevTools)

**예상 결과:**
- ✓ 5초 이내 처리 완료
- ✓ 메모리 누수 없음

### Test Case 19: CSV 파싱 속도
**목적:** CSV 파일 파싱 성능

**단계:**
1. 1000행의 CSV 파일 준비
2. 업로드 및 파싱 시간 측정 (3초 이내 권장)
3. UI가 블로킹되지 않는지 확인

**예상 결과:**
- ✓ 빠른 파싱 속도
- ✓ UI 응답성 유지

## 에러 복구 테스트

### Test Case 20: 네트워크 오류
**목적:** 네트워크 오류 시 적절한 처리

**단계:**
1. Chrome DevTools에서 네트워크를 오프라인으로 설정
2. 출석 데이터 제출 시도
3. 오류 메시지가 표시되는지 확인
4. 네트워크를 다시 온라인으로 설정
5. 재시도 시 정상 처리되는지 확인

**예상 결과:**
- ✓ 명확한 오류 메시지
- ✓ 데이터 손실 없음
- ✓ 재시도 가능

## 테스트 체크리스트

### 날짜별 일괄 입력
- [ ] Test Case 1: 기본 출석 입력
- [ ] Test Case 2: 불참 사유 입력
- [ ] Test Case 3: 전체 선택/해제
- [ ] Test Case 4: 파트별 선택
- [ ] Test Case 5: 대량 데이터 처리

### CSV 파일 업로드
- [ ] Test Case 6: CSV 템플릿 다운로드
- [ ] Test Case 7: 유효한 CSV 업로드
- [ ] Test Case 8: 잘못된 날짜 형식
- [ ] Test Case 9: 존재하지 않는 회원
- [ ] Test Case 10: 중복 데이터
- [ ] Test Case 11: 부분 성공
- [ ] Test Case 12: 대용량 파일
- [ ] Test Case 13: is_available 다양한 값

### 권한 및 보안
- [ ] Test Case 14: 권한 없는 사용자
- [ ] Test Case 15: 비로그인 사용자

### UI/UX
- [ ] Test Case 16: 반응형 디자인
- [ ] Test Case 17: 로딩 상태

### 성능
- [ ] Test Case 18: 100명 출석 입력
- [ ] Test Case 19: CSV 파싱 속도

### 에러 복구
- [ ] Test Case 20: 네트워크 오류

## 버그 발견 시

버그를 발견하면 다음 정보를 포함하여 리포트하세요:

1. **테스트 케이스 번호**
2. **재현 단계**
3. **예상 결과**
4. **실제 결과**
5. **스크린샷** (가능한 경우)
6. **브라우저 및 버전**
7. **콘솔 에러 메시지** (가능한 경우)

## 참고 자료

- 사용자 가이드: `/docs/bulk-attendance-guide.md`
- API 문서: `/src/app/api/attendances/batch/route.ts`
- 컴포넌트: `/src/components/features/attendances/`
